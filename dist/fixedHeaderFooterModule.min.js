angular.module("fixedHeaderFooter",["ui.bootstrap.position"]).service("fixedHeaderFooterGroup",function(){function getInstance(type,id){return type&&id?instances[type][id]:void 0}function addInstance(type,scope,el,attrs){var args=arguments;angular.forEach(scope.Ids,function(id,index){instances[type][id]=args})}var instances={top:{},bottom:{}};return{getInstance:getInstance,addInstance:addInstance}}).directive("fixedHeaderFooterTop",["topBottomDirectiveFactory",function(topBottomDirectiveFactory){return topBottomDirectiveFactory.topBottomDirective("top")}]).directive("fixedHeaderFooterBottom",["topBottomDirectiveFactory",function(topBottomDirectiveFactory){return topBottomDirectiveFactory.topBottomDirective("bottom")}]).factory("topBottomDirectiveFactory",function(){var topBottomDirective=function(type){return{scope:{Ids:"top"===type?"=fixedHeaderFooterTop":"=fixedHeaderFooterBottom"},controller:function($scope,$element,$attrs,fixedHeaderFooterGroup){fixedHeaderFooterGroup.addInstance(type,$scope,$element,$attrs)}}};return{topBottomDirective:topBottomDirective}}).directive("fixedHeaderFooter",["$timeout","$compile","$window","$position","fixedHeaderFooterGroup",function($timeout,$compile,$window,$position,fixedHeaderFooterGroup){function link(scope,el,attrs){function getSetWidth(source,target){var index=0,newWidth=0;for(index=0;index<source.length;index++)newWidth=source[index].getBoundingClientRect().width||angular.element(source[index]).prop("offsetWidth"),angular.element(target[index]).css({width:newWidth+"px"})}function addPx(styles){for(style in styles)"position"!==style&&(styles[style]+="px");return styles}function refreshHeaderFooter(){var headerStyle={position:"absolute"},footerStyle={position:"absolute"},pageYOffset=$window.pageYOffset,innerHeight=$window.innerHeight,tableParent=el.parent().parent().parent(),parnetContainer=$position.offset(tableParent),elParentRelativePos=$position.position(el.parent());parnetContainer.height=tableParent[0].clientHeight;var positionHead=$position.position(el.find("thead")),positionFoot=$position.position(el.find("tfoot")),topContainer=fixedHeaderFooterGroup.getInstance("top",scope.fixedHeaderFooterOptions.topId),topContainerHeight=topContainer?topContainer[2][0].clientHeight:0,bottomContainer=fixedHeaderFooterGroup.getInstance("bottom",scope.fixedHeaderFooterOptions.bottomId),bottomContainerHeight=bottomContainer?bottomContainer[2][0].clientHeight:0;headerStyle.height=positionHead.height,footerStyle.height=positionFoot.height,headerStyle.width=positionHead.width,footerStyle.width=positionFoot.width,headerStyle.top=0,footerStyle.top=0;var topCorr=pageYOffset-parnetContainer.top+topContainerHeight;elHeadParent.css({position:"",top:"",overflow:""}),topCorr>0&&parnetContainer.height>=topCorr&&elParentRelativePos.top<=tableParent[0].scrollTop?(headerStyle.position="fixed",headerStyle.top=topContainerHeight,elHeadParent.css({position:"fixed",top:headerStyle.top,overflow:"hidden",width:tableParent[0].clientWidth}),headerStyle.top="",headerStyle.position="",elHeadParent[0].scrollLeft=tableParent[0].scrollLeft):elParentRelativePos.top>tableParent[0].scrollTop?headerStyle.top=elParentRelativePos.top:headerStyle.top=tableParent[0].scrollTop,elFootParent.css({position:"",top:"",overflow:"",width:""});var bottomCorr=parnetContainer.top+parnetContainer.height-(pageYOffset+innerHeight)+bottomContainerHeight;bottomCorr>0&&parnetContainer.height>=bottomCorr?(footerStyle.position="fixed",footerStyle.top=innerHeight-bottomContainerHeight-footerStyle.height,elFootParent.css({position:"fixed",top:footerStyle.top,overflow:"hidden",width:tableParent[0].clientWidth}),footerStyle.top="",footerStyle.position="",elFootParent[0].scrollLeft=tableParent[0].scrollLeft):footerStyle.top=tableParent[0].scrollTop+tableParent[0].clientHeight-footerStyle.height,0!=tableParent[0].scrollTop&&tableParent[0].scrollTop+parnetContainer.height>=$position.position(el).height+elParentRelativePos.top&&delete footerStyle.top,addPx(headerStyle),addPx(footerStyle),elHead.css(headerStyle),elFoot.css(footerStyle),getSetWidth(el.find("thead").find("th"),elHead.find("tr").find("th")),getSetWidth(el.find("tfoot").find("th"),elFoot.find("tr").find("th"))}var cloneNode=el.clone();cloneNode.find("tbody").empty(),cloneNode.removeAttr("fixed-header-footer"),cloneNode.css({"background-color":""===el[0].style.backgroundColor?"white":el[0].style.backgroundColor,"z-index":void 0===scope.fixedHeaderFooterOptions.zIndex?1001:scope.fixedHeaderFooterOptions.zIndex,"margin-bottom":0});var cloneHeadFoot={thead:cloneNode.clone(),tfoot:cloneNode.clone()};cloneHeadFoot.thead.find("tfoot").empty(),cloneHeadFoot.tfoot.find("thead").empty();var elHead=$compile(cloneHeadFoot.thead)(scope.$parent,function(){}),elFoot=$compile(cloneHeadFoot.tfoot)(scope.$parent,function(){}),tablecontainer=el.parent().parent();tablecontainer.wrap('<div style="position: relative;clear: both;overflow:scroll"></div>'),tablecontainer.append(elHead),tablecontainer.append(elFoot),elHead=elHead.wrap('<div style="position: absolute"></div>').parent().wrap("<div></div>"),elFoot=elFoot.wrap('<div style="position: absolute"></div>').parent().wrap("<div></div>");var elHeadParent=elHead.parent(),elFootParent=elFoot.parent();angular.isFunction(scope.fixedHeaderFooterOptions.onRegisterApi)&&scope.fixedHeaderFooterOptions.onRegisterApi.call(this,scope.fixedHeaderFooterOptions,refreshHeaderFooter),$timeout(function(){refreshHeaderFooter()},100,!1),tablecontainer.parent("div").on("scroll",function(){refreshHeaderFooter()}),angular.element($window).on("resize scroll",function(){refreshHeaderFooter()}),scope.$on("$destroy",function(){tablecontainer.parent("div").off("scroll"),angular.element($window).off("scroll"),angular.element($window).off("resize")})}return{scope:{fixedHeaderFooterOptions:"=fixedHeaderFooter"},link:link}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]),angular.module("fixedHeaderFooter",["ui.bootstrap.position"]).service("fixedHeaderFooterGroup",function(){function getInstance(type,id){return type&&id?instances[type][id]:void 0}function addInstance(type,scope,el,attrs){var args=arguments;angular.forEach(scope.Ids,function(id,index){instances[type][id]=args})}var instances={top:{},bottom:{}};return{getInstance:getInstance,addInstance:addInstance}}).directive("fixedHeaderFooterTop",["topBottomDirectiveFactory",function(topBottomDirectiveFactory){return topBottomDirectiveFactory.topBottomDirective("top")}]).directive("fixedHeaderFooterBottom",["topBottomDirectiveFactory",function(topBottomDirectiveFactory){return topBottomDirectiveFactory.topBottomDirective("bottom")}]).factory("topBottomDirectiveFactory",function(){var topBottomDirective=function(type){return{scope:{Ids:"top"===type?"=fixedHeaderFooterTop":"=fixedHeaderFooterBottom"},controller:function($scope,$element,$attrs,fixedHeaderFooterGroup){fixedHeaderFooterGroup.addInstance(type,$scope,$element,$attrs)}}};return{topBottomDirective:topBottomDirective}}).directive("fixedHeaderFooter",["$timeout","$compile","$window","$position","fixedHeaderFooterGroup",function($timeout,$compile,$window,$position,fixedHeaderFooterGroup){function link(scope,el,attrs){function getSetWidth(source,target){var index=0,newWidth=0;for(index=0;index<source.length;index++)newWidth=source[index].getBoundingClientRect().width||angular.element(source[index]).prop("offsetWidth"),angular.element(target[index]).css({width:newWidth+"px"})}function addPx(styles){for(style in styles)"position"!==style&&(styles[style]+="px");return styles}function refreshHeaderFooter(){var headerStyle={position:"absolute"},footerStyle={position:"absolute"},pageYOffset=$window.pageYOffset,innerHeight=$window.innerHeight,tableParent=el.parent().parent().parent(),parnetContainer=$position.offset(tableParent),elParentRelativePos=$position.position(el.parent());parnetContainer.height=tableParent[0].clientHeight;var positionHead=$position.position(el.find("thead")),positionFoot=$position.position(el.find("tfoot")),topContainer=fixedHeaderFooterGroup.getInstance("top",scope.fixedHeaderFooterOptions.topId),topContainerHeight=topContainer?topContainer[2][0].clientHeight:0,bottomContainer=fixedHeaderFooterGroup.getInstance("bottom",scope.fixedHeaderFooterOptions.bottomId),bottomContainerHeight=bottomContainer?bottomContainer[2][0].clientHeight:0;headerStyle.height=positionHead.height,footerStyle.height=positionFoot.height,headerStyle.width=positionHead.width,footerStyle.width=positionFoot.width,headerStyle.top=0,footerStyle.top=0;var topCorr=pageYOffset-parnetContainer.top+topContainerHeight;elHeadParent.css({position:"",top:"",overflow:""}),topCorr>0&&parnetContainer.height>=topCorr&&elParentRelativePos.top<=tableParent[0].scrollTop?(headerStyle.position="fixed",headerStyle.top=topContainerHeight,elHeadParent.css({position:"fixed",top:headerStyle.top,overflow:"hidden",width:tableParent[0].clientWidth}),headerStyle.top="",headerStyle.position="",elHeadParent[0].scrollLeft=tableParent[0].scrollLeft):elParentRelativePos.top>tableParent[0].scrollTop?headerStyle.top=elParentRelativePos.top:headerStyle.top=tableParent[0].scrollTop,elFootParent.css({position:"",top:"",overflow:"",width:""});var bottomCorr=parnetContainer.top+parnetContainer.height-(pageYOffset+innerHeight)+bottomContainerHeight;bottomCorr>0&&parnetContainer.height>=bottomCorr?(footerStyle.position="fixed",footerStyle.top=innerHeight-bottomContainerHeight-footerStyle.height,elFootParent.css({position:"fixed",top:footerStyle.top,overflow:"hidden",width:tableParent[0].clientWidth}),footerStyle.top="",footerStyle.position="",elFootParent[0].scrollLeft=tableParent[0].scrollLeft):footerStyle.top=tableParent[0].scrollTop+tableParent[0].clientHeight-footerStyle.height,0!=tableParent[0].scrollTop&&tableParent[0].scrollTop+parnetContainer.height>=$position.position(el).height+elParentRelativePos.top&&delete footerStyle.top,addPx(headerStyle),addPx(footerStyle),elHead.css(headerStyle),elFoot.css(footerStyle),getSetWidth(el.find("thead").find("th"),elHead.find("tr").find("th")),getSetWidth(el.find("tfoot").find("th"),elFoot.find("tr").find("th"))}var cloneNode=el.clone();cloneNode.find("tbody").empty(),cloneNode.removeAttr("fixed-header-footer"),cloneNode.css({"background-color":""===el[0].style.backgroundColor?"white":el[0].style.backgroundColor,"z-index":void 0===scope.fixedHeaderFooterOptions.zIndex?1001:scope.fixedHeaderFooterOptions.zIndex,"margin-bottom":0});var cloneHeadFoot={thead:cloneNode.clone(),tfoot:cloneNode.clone()};cloneHeadFoot.thead.find("tfoot").empty(),cloneHeadFoot.tfoot.find("thead").empty();var elHead=$compile(cloneHeadFoot.thead)(scope.$parent,function(){}),elFoot=$compile(cloneHeadFoot.tfoot)(scope.$parent,function(){}),tablecontainer=el.parent().parent();tablecontainer.wrap('<div style="position: relative;clear: both;overflow:scroll"></div>'),tablecontainer.append(elHead),tablecontainer.append(elFoot),elHead=elHead.wrap('<div style="position: absolute"></div>').parent().wrap("<div></div>"),elFoot=elFoot.wrap('<div style="position: absolute"></div>').parent().wrap("<div></div>");var elHeadParent=elHead.parent(),elFootParent=elFoot.parent();angular.isFunction(scope.fixedHeaderFooterOptions.onRegisterApi)&&scope.fixedHeaderFooterOptions.onRegisterApi.call(this,scope.fixedHeaderFooterOptions,refreshHeaderFooter),$timeout(function(){refreshHeaderFooter()},100,!1),tablecontainer.parent("div").on("scroll",function(){refreshHeaderFooter()}),angular.element($window).on("resize scroll",function(){refreshHeaderFooter()}),scope.$on("$destroy",function(){tablecontainer.parent("div").off("scroll"),angular.element($window).off("scroll"),angular.element($window).off("resize")})}return{scope:{fixedHeaderFooterOptions:"=fixedHeaderFooter"},link:link}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]);